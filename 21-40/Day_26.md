**タイトル:**  
未経験から100日後にGTMのプロになる話【Day 26】  
トリガー条件の組み合わせと正規表現 〜複雑な発火条件を自在に操る〜

---

**概要（リード文）:**  
「特定のページで、特定のボタンがクリックされたときだけタグを発火させたい！」  
「URLが特定のパターンに一致した場合だけトリガーを作動させたい！」  
GTMでは、トリガー条件を自由に組み合わせたり、正規表現を活用することで、タグ発火を細かく制御できます。本日は、その実践方法を解説します！

---

## **本文**

### ■ なぜトリガーの条件設定が重要なのか？

GTMでは、「すべてのページ」「すべてのクリック」などのシンプルな条件でトリガーを設定できますが、実際の運用ではもっと細かい条件設定が求められます。

例えば、
✅ **「/campaign/ を含むURLで、特定のCTAボタンがクリックされたときだけ発火」**  
✅ **「ECサイトの商品ページのうち、特定のカテゴリのページでだけタグを発火」**  
✅ **「特定のパターンのURLに一致する場合だけ、タグを発火」**  

こうした細かい発火条件を設定することで、不要なタグ発火を防ぎ、データ計測の精度を向上させることができます。

では、実際の設定方法を見ていきましょう！

---

### **① トリガーの条件をAND/ORで組み合わせる**

#### **1. AND条件の設定（すべての条件を満たす場合に発火）**

例えば、「`/campaign/` を含むページで、『お問い合わせ』ボタンがクリックされたときのみ発火」するトリガーを作成します。

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**クリック - すべての要素**」に設定。
3. 「このトリガーの発火を…」のオプションを「**一部のクリック**」に変更。
4. 以下の条件を追加。
   - **Page URL**「次を含む」 `/campaign/`
   - **Click Text**「次を含む」 `お問い合わせ`
5. トリガー名を「キャンペーンお問い合わせボタンクリック」にして保存。

✅ **これで、「/campaign/ ページ内の『お問い合わせ』ボタンがクリックされたときのみ発火」する設定になります！**

---

#### **2. OR条件の設定（いずれかの条件を満たす場合に発火）**

例えば、「`/product/` を含むページ **または** `/service/` を含むページでタグを発火」させる場合、

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**ページビュー**」に設定。
3. 「このトリガーの発火を…」のオプションを「**一部のページビュー**」に変更。
4. 以下の条件を追加。
   - **Page URL**「次を含む」 `/product/`
   - **または**（「+ 条件を追加」をクリック）
   - **Page URL**「次を含む」 `/service/`
5. トリガー名を「商品・サービスページ閲覧」にして保存。

✅ **これで、「/product/ または /service/」を含むURLでタグが発火するようになります！**

---

### **② 正規表現を使ったトリガー設定**

正規表現（RegExp）を活用すると、より柔軟な条件設定が可能になります。

例えば、
✅ **「/product/abc」「/product/xyz」「/product/123」のようなURLパターンすべてに対応したい」**  
✅ **「ドメインが `example.com` または `test.com` の場合のみ発火したい」**  

こうした場合、通常は複数の条件を追加する必要がありますが、正規表現を使えば **「/product/ の後に何かが続くURLすべて」** を1つの条件でカバーできます。

#### **1. 正規表現を使ったトリガーの作成**

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**ページビュー**」に設定。
3. 「このトリガーの発火を…」のオプションを「**一部のページビュー**」に変更。
4. 以下の条件を設定。
   - **Page URL**「一致する正規表現」 `^/product/.*`
5. トリガー名を「商品ページ全体」にして保存。

✅ **これで、/product/ で始まるすべてのURLでタグが発火するようになります！**

---

### **③ GA4のイベントタグを作成する（トリガーを適用）**

#### **1. GA4のタグを作成**

1. GTMの「**タグ**」メニューを開く。
2. 「**新規**」をクリックし、タグの種類を「**Google アナリティクス: GA4 イベント**」に設定。
3. 「**設定タグを選択**」で、すでに作成したGA4設定タグを選択。
4. 「**イベント名**」を `campaign_contact_click` にする。

#### **2. トリガーを設定**

1. 作成したGA4イベントタグの「**トリガー**」をクリック。
2. 先ほど作成した「**キャンペーンお問い合わせボタンクリック**」トリガーを選択。
3. 保存。

✅ **これで、キャンペーンページ内のお問い合わせボタンがクリックされたときのみGA4にデータが送信されます！**

---

### **④ プレビューモードで動作確認**

タグを本番適用する前に、必ずプレビューモードでテストしましょう。

1. GTMの「**プレビュー**」を開く。
2. 計測対象のサイトを開き、対象のページに移動。
3. デバッグツールの「Tags Fired（発火したタグ）」にGA4のタグがあるか確認。
4. GA4のリアルタイムレポートで `campaign_contact_click` が記録されているか確認。

✅ **問題なくデータが送信されていることを確認したら、GTMの「送信」ボタンを押して公開！**

---

### **■ まとめ 〜トリガー条件を自在に操ろう！〜**

✅ **トリガーの条件をAND/ORで組み合わせることで、細かい発火条件を設定できる！**  
✅ **正規表現を使えば、複数の条件をスマートに指定できる！**  
✅ **GTMの「プレビューモード」でテストし、問題なければ公開する！**  

次回は、**「データレイヤーを活用した高度なタグ管理」** を解説します！

