**タイトル:**  
未経験から100日後にGTMのプロになる話【Day 27】  
データレイヤーを活用した高度なタグ管理 〜GTMの真価を引き出す〜

---

**概要（リード文）:**  
「タグの発火条件をより柔軟に管理したい！」  
「ページの特定情報を取得して、タグのデータとして活用したい！」  
そんなときに欠かせないのが **データレイヤー（Data Layer）** の活用です。本日は、データレイヤーを使ってGTMの計測精度を飛躍的に向上させる方法を解説します！

---

## **本文**

### ■ データレイヤーとは？

データレイヤー（Data Layer）とは、**ウェブサイト上のデータをGTMで取得しやすくするための仕組み** です。

例えば、
✅ **「ユーザーが購入した商品情報をGA4に送信したい！」**  
✅ **「ECサイトのカートに追加された商品のカテゴリを取得したい！」**  
✅ **「ユーザーの会員ランク（VIPなど）をタグの発火条件に使いたい！」**  

こうしたデータを **`dataLayer.push()`** を使ってGTMに渡せば、タグの発火条件や計測データのカスタマイズが可能になります。

では、実際に設定方法を見ていきましょう！

---

### **① データレイヤーの基本的な仕組み**

#### **1. `dataLayer.push()` を使ってデータを送信する**

例えば、ECサイトの「購入完了ページ」で、購入情報をデータレイヤーに送る場合、以下のようなコードをページの `<script>` 内に追加します。

```javascript
<script>
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    'event': 'purchase',
    'transaction_id': 'T123456',
    'value': 9800,
    'currency': 'JPY',
    'items': [
      {
        'id': 'P001',
        'name': 'スニーカー',
        'category': 'シューズ',
        'price': 9800
      }
    ]
  });
</script>
```

✅ **このコードにより、GTMは `purchase` というイベントとともに、購入情報を取得できるようになります！**

---

### **② GTMでデータレイヤー変数を作成する**

データレイヤーの情報をGTMで活用するには、「データレイヤー変数」を設定します。

#### **1. データレイヤー変数を作成する**

1. GTMの「**変数**」メニューを開く。
2. 「**新規**」をクリックし、変数の種類を「**データレイヤー変数**」に設定。
3. 「**データレイヤー変数名**」に `transaction_id` を入力。
4. 変数名を「DLV - Transaction ID」として保存。
5. 同じ手順で `value`、`currency` も作成。

✅ **これで、購入完了時の「注文ID」「購入金額」「通貨」をGTM内で取得できるようになりました！**

---

### **③ GA4のイベントタグにデータレイヤー変数を適用する**

#### **1. GA4の購入イベントタグを作成する**

1. GTMの「**タグ**」メニューを開く。
2. 「**新規**」をクリックし、タグの種類を「**Google アナリティクス: GA4 イベント**」に設定。
3. 「**設定タグを選択**」で、すでに作成したGA4設定タグを選択。
4. 「**イベント名**」を `purchase` にする。

#### **2. イベントパラメータを設定する**

1. 「イベントパラメータを追加」ボタンをクリック。
2. 以下のパラメータを追加。
   - **パラメータ名:** `transaction_id`（値: `{{DLV - Transaction ID}}`）
   - **パラメータ名:** `value`（値: `{{DLV - Value}}`）
   - **パラメータ名:** `currency`（値: `{{DLV - Currency}}`）
3. 保存。

✅ **これで、購入完了時に「注文ID」「購入金額」「通貨」をGA4に送信できます！**

---

### **④ トリガーを設定する（購入完了時に発火）**

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**カスタムイベント**」に設定。
3. 「イベント名」に `purchase` を入力。
4. 保存。

✅ **これで、「購入完了時にGA4のイベントタグが発火」する設定ができました！**

---

### **⑤ プレビューモードで動作確認**

タグを本番適用する前に、必ずプレビューモードでテストしましょう。

1. GTMの「**プレビュー**」を開く。
2. 計測対象のサイトで購入手続きを完了する。
3. デバッグツールの「Data Layer」タブを確認し、 `purchase` イベントが送られているかチェック。
4. 「Tags Fired（発火したタグ）」にGA4のイベントタグがあるか確認。
5. GA4のリアルタイムレポートで `purchase` イベントが記録されているか確認。

✅ **問題なくデータが送信されていることを確認したら、GTMの「送信」ボタンを押して公開！**

---

### **■ まとめ 〜データレイヤーで高度なタグ管理を実現！〜**

今回の学びを整理すると…

✅ **データレイヤーを活用すると、ページの情報をGTMで簡単に取得できる！**  
✅ **データレイヤー変数を作成し、タグのデータとして活用できる！**  
✅ **GA4のイベントタグにデータレイヤー変数を適用し、購入情報を送信できる！**  
✅ **「プレビューモード」でテストし、問題なければ公開する！**  

これを活用すれば、
- **「ECサイトの売上データを正確に計測」**
- **「ユーザーの行動データをタグの条件として利用」**
- **「開発者と連携してより高度な計測を実現」**

といったことが可能になります！

---

### **■ 明日の予告 〜ECサイト向け計測設定（Google広告＆GA4）〜**

次回は、**「ECサイトでの計測設定」** を学びます！
- **「購入完了時の計測」**
- **「Google広告のコンバージョン計測」**
- **「GA4のEコマースイベント」**

など、EC向けの計測手法を解説します！

