**タイトル:**  
未経験から100日後にGTMのプロになる話【Day 19】  
トリガー条件の組み合わせと正規表現 〜タグ発火を自由自在に操る〜

---

**概要（リード文）:**  
「このページの、このボタンがクリックされたときだけ計測したい！」  
「URLが特定のパターンに合致した場合だけトリガーを発火させたい！」  
こうした細かい条件設定を実現するために、GTMの「トリガー条件の組み合わせ」と「正規表現」を活用する方法を解説します。

---

## **本文**

### ■ なぜトリガー条件の組み合わせが必要なのか？

GTMでは、「すべてのページ」「すべてのクリック」など、シンプルな条件でトリガーを発火できますが、現場ではより細かい条件設定が求められます。

例えば、
✅ **「/campaign/」を含むURLのページでクリックされたボタンだけを計測したい」**  
✅ **「購入完了ページだけで特定のタグを発火させたい」**  
✅ **「特定のボタンがクリックされたときにGA4と広告タグを同時に発火させたい」**  

こうした複雑な条件を組み合わせることで、**不要なタグ発火を防ぎ、正確な計測を実現** できます。

では、実際に設定していきましょう！

---

### **① トリガー条件をAND/ORで組み合わせる**

#### **1. GTMのトリガー条件を設定する（AND条件）**

例えば、「/campaign/」を含むページで「お問い合わせボタン（Click Textが'お問い合わせ'）」がクリックされたときだけタグを発火させる設定を作成します。

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**クリック - すべての要素**」に設定。
3. 「このトリガーの発火を…」のオプションを「**一部のクリック**」に変更。
4. 以下の条件を追加。
   - **Page URL**「次を含む」 `/campaign/`
   - **Click Text**「次を含む」 `お問い合わせ`
5. トリガー名を「キャンペーンお問い合わせボタンクリック」にして保存。

✅ **これで、「キャンペーンページ内のお問い合わせボタンのクリック時のみ発火」する設定になります！**

---

#### **2. GTMのトリガー条件を設定する（OR条件）**

例えば、「/product/」を含むページ **または** 「/service/」を含むページで発火するトリガーを作成する場合、次のように設定します。

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**ページビュー**」に設定。
3. 「このトリガーの発火を…」のオプションを「**一部のページビュー**」に変更。
4. 以下の条件を追加。
   - **Page URL**「次を含む」 `/product/`
   - **または**（「+ 条件を追加」をクリック）
   - **Page URL**「次を含む」 `/service/`
5. トリガー名を「商品・サービスページ閲覧」にして保存。

✅ **これで、「/product/ または /service/」を含むURLでタグが発火するようになります！**

---

### **② 正規表現を使ったトリガー設定**

正規表現（RegExp）を活用すると、より柔軟な条件設定が可能になります。

例えば、次のようなURLパターンをすべて対象にする場合、
- `/product/abc`
- `/product/xyz`
- `/product/123`

通常の条件設定では複数の条件を追加する必要がありますが、正規表現を使えば **「/product/の後に何かが続くURLすべて」** を1つの条件でカバーできます。

#### **1. 正規表現を使ったトリガーの作成**

1. GTMの「**トリガー**」メニューを開く。
2. 「**新規**」をクリックし、トリガーの種類を「**ページビュー**」に設定。
3. 「このトリガーの発火を…」のオプションを「**一部のページビュー**」に変更。
4. 以下の条件を設定。
   - **Page URL**「一致する正規表現」 `^/product/.*`
5. トリガー名を「商品ページ全体」にして保存。

✅ **これで、/product/ で始まるすべてのURLでタグが発火するようになります！**

---

### **③ GA4のイベントタグを作成する（トリガーを適用）**

#### **1. GA4のタグを作成**

1. GTMの「**タグ**」メニューを開く。
2. 「**新規**」をクリックし、タグの種類を「**Google アナリティクス: GA4 イベント**」に設定。
3. 「**設定タグを選択**」で、すでに作成したGA4設定タグを選択。
4. 「**イベント名**」を `campaign_contact_click` にする。

#### **2. トリガーを設定**

1. 作成したGA4イベントタグの「**トリガー**」をクリック。
2. 先ほど作成した「**キャンペーンお問い合わせボタンクリック**」トリガーを選択。
3. 保存。

✅ **これで、キャンペーンページ内のお問い合わせボタンがクリックされたときのみGA4にデータが送信されます！**

---

### **④ プレビューモードで動作確認**

タグを本番適用する前に、必ずプレビューモードでテストしましょう。

1. GTMの「**プレビュー**」を開く。
2. 計測対象のサイトを開き、対象のページに移動。
3. デバッグツールの「Tags Fired（発火したタグ）」にGA4のタグがあるか確認。
4. GA4のリアルタイムレポートで `campaign_contact_click` が記録されているか確認。

✅ **問題なくデータが送信されていることを確認したら、GTMの「送信」ボタンを押して公開！**

---

### **■ まとめ 〜トリガーを自在に操ろう！〜**

今回の学びを整理すると…

✅ **トリガーの条件をAND/ORで組み合わせることで、細かい発火条件を設定できる！**  
✅ **正規表現を使えば、複数の条件をスマートに指定できる！**  
✅ **GTMの「プレビューモード」でテストし、問題なければ公開する！**  

これを活用すれば、
- **「特定のページ内で特定のボタンをクリックした場合だけ計測」**
- **「特定のURLパターンに一致するページでタグを発火」**

といった計測が可能になります！

---

### **■ 明日の予告 〜変数を使った柔軟なタグ設定〜**

次回は、**「変数を活用した高度なタグ設定」** を学びます！

